<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Open Lab Frame  </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./static/Logo/favicon.ico" />
<link rel="icon" type="image/png" href="./static/Logo/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="./static/Logo/favicon-16x16.png" sizes="16x16" />

    <link href="./static/style.css" rel="stylesheet">
        </head>
<body>
<header class="site-header">
    <div class="wrapper">
        <div class=header-text>
   
    <h1 class="site-title">Open Lab Frame  </h1>
   
    <p class="author">by MEP (Multi-Engineering Platform)</p>
    <p class="affiliation">CENTURI (Turing Centre for Living Systems)</p>
</div>
            </div>
</header>
<div class="page-content">
            <div>
            <nav class="sidebar">
                <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
                </a>
                <ul class="nav-list">
                <li>
    <a class="navhome" href="./">
        Open Lab Frame  
    </a>
</li>
<li class="not-active">
    <a class="not-active" href="./index_BOM.html">
        Bill of Materials
    </a>
    </li>
<li class="not-active">
    <a class="not-active" href="./psu_control.html">
        Power Suply Unit and control box
    </a>
    </li>
<li class="active">
    <a class="active" href="./arduino_cncshield.html">
        Update Arduino board and CNC shield  
    </a>
    </li>

                </ul>
            </nav>
        </div>
        <div class="wrapper">
    <h1 id="update-arduino-board-and-cnc-shield">Update Arduino board and CNC shield</h1>
<div class="pagebom">
<h3 id="parts">Parts</h3>
<ul>
<li>1 <a Class="bom" href="Parts/JumpersWires_FemaleMale.html">female to male jumper wire</a> </li>
<li>2 <a Class="bom" href="Parts/Jumpers.html">jumpers</a> </li>
<li>4 <a Class="bom" href="Parts/StepperMotors.html">stepper motors</a> </li>
</ul>
<h3 id="tools">Tools</h3>
<ul>
<li>1 <a Class="bom" href="Parts/Multimeter.html">multimeter</a> </li>
</ul>
<h3 id="test-connectors">Test Connectors</h3>
<ul>
<li>2 <a Class="bom" href="Parts/CrocodileClip.html">crocodile clip</a> </li>
</ul>
</div>
<div class="info-block">
<p><strong>Note</strong>  <br />
In the following section we will consider the CNC shiled is used to move 4 motors on axis X, Y and Z, with a clone on Z axis (therefore 2 motors for Z axis).</p>
</div>
<p>This is what the CNC shield should look like. </p>
<p><img alt="" src="images/cnc-shield_plugged.png" title="" />  </p>
<p>Make sure : </p>
<ul>
<li>It is powered (wires on the bottom left of the image, connected to the PSU);</li>
<li>The emergency button is connected (wires on the bottom right of the image);</li>
<li>The A4899 stepper drivers are plugged corretly (potentiometer directed toward the bottom of the CNC shield).</li>
<li>The Arduino Uno is connected to a computer. Not necesserly the RPi, you can connect it to another computer if you feel more confortable to upload Grbl and test the CNC shield.</li>
</ul>
<h2 class="page-step" id="upload-the-firmware--grbl">Step 1: Upload the firmware : Grbl</h2>
<p>To upload Grbl on the [Arduino board], just follow instructions available on <a href="https://github.com/gnea/grbl/wiki/Compiling-Grbl" target="_blank" title="">Grbl's wiki </a>.  </p>
<div class="info-block">
<p><strong>With less than 3 axis</strong><br />
According to the number of axis you want, you will have a few changes to make on the <code>config.h</code> file located in <code>Arduino&gt;libraries&gt;grbl</code>. Open it with a text editor, then read from line 90 to 113.<br />
Examples:</p>
<ul>
<li><strong>Just X and Y axis ?</strong> Comment lines 105 and 106, and uncomment line 110 as follow:<br />
<em>105 : // #define HOMING_CYCLE_1 ((1&lt;&lt;X_AXIS)|(1&lt;&lt;Y_AXIS))  // OPTIONAL: Then move X,Y at the same time.</em><br />
<em>106 : // #define HOMING_CYCLE_2                         // OPTIONAL: Uncomment and add axes mask to enable</em><br />
<em>110 : #define HOMING_CYCLE_0 ((1&lt;&lt;X_AXIS)|(1&lt;&lt;Y_AXIS))  // NOT COMPATIBLE WITH COREXY: Homes both X-Y in one cycle.</em>  </li>
<li><strong>Just X and Z axis in this order ?</strong> Modify lines 105 and 106 as follow:  <br />
<em>105 : #define HOMING_CYCLE_0 (1&lt;&lt;X_AXIS)                // Move X first.</em> <br />
<em>106 : #define HOMING_CYCLE_1 (1&lt;&lt;Z_AXIS) // Then move Z.</em>  <br />
Then compile and flash Grbl to the Arduino, from the Arduino IDE : <code>File&gt;Examples&gt;grbl&gt;grblUpload</code>.  </li>
</ul>
</div>
<p>Once Grbl is compiled and flashed to the Arduino board, it is a good idea to have default settings in a first place. Open the Serial Monitor in the Arduino IDE (Tools &gt; Serial Monitor), then check Grbl settings typing <code>$$</code> then Enter, into the Serial Monitor. The settings should look like this (according to <a href="https://github.com/gnea/grbl/wiki/Grbl-v1.1-Configuration" target="_blank" title="">Grbl wiki : Grbl v1.1 Configuration</a>) :  </p>
<pre>
Settings and sample values  Description
$0=10   Step pulse, microseconds
$1=25   Step idle delay, milliseconds
$2=0    Step port invert, mask
$3=0    Direction port invert, mask
$4=0    Step enable invert, boolean
$5=0    Limit pins invert, boolean
$6=0    Probe pin invert, boolean
$10=1   Status report, mask
$11=0.010   Junction deviation, mm
$12=0.002   Arc tolerance, mm
$13=0   Report inches, boolean
<b style="color:green">$20=0    Soft limits, boolean</b>
<b style="color:green">$21=0    Hard limits, boolean</b>
$22=1   Homing cycle, boolean
<b style="color:green">$23=0    Homing dir invert, mask</b>
$24=25.000  Homing feed, mm/min
$25=500.000     Homing seek, mm/min
$26=250     Homing debounce, milliseconds
$27=1.000   Homing pull-off, mm
$30=1000.   Max spindle speed, RPM
$31=0.  Min spindle speed, RPM
$32=0   Laser mode, boolean
<b style="color:green">$100=250.000     X steps/mm
$101=250.000    Y steps/mm
$102=250.000    Z steps/mm
$110=500.000    X Max rate, mm/min
$111=500.000    Y Max rate, mm/min
$112=500.000    Z Max rate, mm/min
$120=10.000     X Acceleration, mm/sec^2
$121=10.000     Y Acceleration, mm/sec^2
$122=10.000     Z Acceleration, mm/sec^2
$130=200.000    X Max travel, mm
$131=200.000    Y Max travel, mm
$132=200.000    Z Max travel, mm</b>
</pre>
<p>If not, then copy each line, and paste it into the Serial Monitor.  </p>
<h2 class="page-step" id="try-with-the-stepper-motors">Step 2: Try with the stepper motors</h2>
<p>Plug the 4x <a href="Parts/StepperMotors.html">stepper motors</a>.  </p>
<p><img alt="" src="images/cnc-shield_motors.png" title="" />  </p>
<p>Then check the motors buy running the following commands into the serial monitor:   </p>
<p><code>G91; This command set all axis to relative. I find it better to test the CNC shield, so you can run many times the same command.</code>  </p>
<p>Then:  </p>
<p><code>G0 X10 Y10 Z10; G0 means 'rapid move' and X10 means 'move 10 mm on X axis'.</code></p>
<h3 id="clone-the-z-axis">Clone the Z axis</h3>
<p>Just add 2x <a href="Parts/Jumpers.html">jumpers</a> on the Z axis line (left of the CNC shield, as seen on the picture below).</p>
<p><img alt="" src="images/cnc-shield_clone-z.png" title="" />  </p>
<div class="info-block">
<p><strong>Note</strong>  </p>
<ul>
<li>You can use the 4rth motor as a clone of X or Y: just place the jumpers on the corresponding line (as seen on the previsou picture).   </li>
<li>You can also use the 4rth motor independently. In this case, add 2 jumpers on the last line after the X, Y and Z lines.</li>
</ul>
</div>
<h3 id="inverse-motor-direction">Inverse motor direction</h3>
<div class="gallery-thumb">
    <img onmouseover="getElementById('gallery-show0').src=this.src" src="images/cnc-shield_x-backward-jumper.png" alt="" />
    <img onmouseover="getElementById('gallery-show0').src=this.src" src="images/cnc-shield_x-backward-inverse.png" alt="" />
</div>
<div class="gallery-show"><img id="gallery-show0" src="images/cnc-shield_x-backward-jumper.png" alt=""/></div>
<p>As seen on the picture, there are 2 possibilities:</p>
<ul>
<li>Rotate the connector to 180°;</li>
<li>OR connect a 5V pin to the DIR pin of interest. On the picture above, an orange jumpers wire is connecting 5V to X.DIR.</li>
</ul>
<h2 id="current-limitation-for-stepper-drivers">Current limitation for stepper drivers</h2>
<p>When refering to <a href="https://www.pololu.com/file/0J450/A4988.pdf" target="_blank" title="">A4988 datasheet from Polulu</a>, current limit should be set for each driver and its motor.   </p>
<div class="info-block">
<p><strong>Quote from https://www.pololu.com/product/1182</strong>
Another way to set the current limit is to calculate the reference voltage that corresponds to your desired current limit and then adjust the current limit potentiometer until you measure that voltage on the VREF pin. The VREF pin voltage is accessible on a via that is circled on the bottom silkscreen of the circuit board. The current limit, IMAX, relates to the reference voltage as follows:</p>
<p>IMAX=VREF8⋅RCS</p>
<p>or, rearranged to solve for VREF:</p>
<p>VREF=8⋅IMAX⋅RCS</p>
<p>RCS is the current sense resistance; original versions of this board used 0.050 Ω current sense resistors, but we switched to using 0.068 Ω current sense resistors in January 2017, which makes more of the adjustment potentiometer’s range useful. </p>
</div>
<p>For example, with :  </p>
<ul>
<li>Stepper motor nominal current : 2A;</li>
<li>RCS : 0.05 Ohm</li>
</ul>
<p>We have : VREF=8<em>2</em>0.05=0.8V  </p>
<p>You can set the current limit as follow:  </p>
<ul>
<li>Make sure the Arduino board is powered (plugged to turned-on computer with USB cable);  </li>
<li>Turn your <a href="Parts/Multimeter.html">multimeter</a> on, and set it to voltage measurement;  </li>
<li>Connect it to a ground GND pin on the CNC shield. To do so, connect a <a href="Parts/JumpersWires_FemaleMale.html">female to male jumper wire</a> to the GND pin, then connect it to the black probe of the multimeter with a <a href="Parts/CrocodileClip.html">crocodile clip</a>;  </li>
<li>Clip another <a href="Parts/CrocodileClip.html">crocodile clip</a> to a tiny screwdriver with conductive tip, and to the red probe of the multimeter;  </li>
<li>Turn the potentiometer on the A4988 chip until you read VREF.</li>
</ul>
<p>This is what it should look like:<br />
<img alt="Current limit on CNC shield with multimeter" src="images/cnc-shield_multimeter.png" title="" /></p>
<hr />
<p><a href="psu_control.html">Previous page</a></p>
    </div>
</div>
<footer class="site-footer">
    <div class="wrapper">
        <a target="_blank" rel="noopener noreferrer" href="https://gitbuilding.io">
    <img class="icon" src="./static/Logo/GitBuilding500x.png" alt="GitBuilding logo">
    <span class="info">Documentation powered by GitBuilding</span>
</a>
    <p class="author">©2022 MEP (Multi-Engineering Platform)</p>
    <p class="email">Contact: <a href="mailto:engineering@centuri-livingsystems.org">engineering@centuri-livingsystems.org</a></p>

    </div>
</footer></body>
</html>